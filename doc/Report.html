<!DOCTYPE html>
<html>
<head>
  	<title>Y86 Simulator Project Report</title>
    <meta charset="utf-8">
  	<style>
  		body 
		{
			margin: 50px;
			background:#e0ffff no-repeat fixed;
		}
		font
		{
			padding: 25px 50px;
		}
		div
		{
			padding: 5px 15px;
		}
  	</style>
</head>

<body>
<h1 style="text-align:center;"> Y86 Simulator Project Report</h1>
<hr style="height:10px;border:none;border-top:10px groove skyblue;">

<h2> 1 概览 </h2>
<div>
<h3> 1.1 开发环境 </h3>
<div>
<table>
  <tbody>
    <tr>
      <td><strong>开发语言</strong></td> <td>JavaScript/HTML/CSS/Python</td>
    </tr>
    <tr>
      <td><strong>浏览器环境</strong></td> <td>Chrome/Firefox/Safari</td>
    </tr>
    <tr>
      <td><strong>第三方库</strong></td>   <td>jQuery/Bootstrap</td>
    </tr>
  </tbody>
</table>
</div>
<h3> 1.2 文件组成 </h3>
<div>
本次project的后端代码均在backend目录下，说明如下：
<table>
<tr>
<td>
<table>
  <thead>
        <tr>
            <th>文件名</th><th>文件说明</th>
        </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>backend/kernel.py</strong></td> <td>核心代码，模拟CPU过程</td>
    </tr>
    <tr>
      <td><strong>backend/stages/Fetch.py</strong></td> <td>流水线取指阶段</td>
    </tr>
    <tr>
      <td><strong>backend/stages/Decode.py</strong></td> <td>流水线译码阶段</td>
    </tr>
    <tr>
      <td><strong>backend/stages/Execute.py</strong></td> <td>流水线执行阶段</td>
    </tr>
    <tr>
      <td><strong>backend/stages/Memory.py</strong></td> <td>流水线访存阶段</td>
    </tr>
    <tr>
      <td><strong>backend/stages/WriteBack.py</strong></td> <td>流水线写回阶段</td>
    </tr>
  </tbody>
</table>
</td>
<td>
<table>
  <thead>
        <tr>
            <th>文件名</th><th>文件说明</th>
        </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>backend/others/cc_stat.py</strong></td> <td>状态码与条件码类</td>
    </tr>
    <tr>
      <td><strong>backend/others/constant.py</strong></td> <td>常量的定义</td>
    </tr>
    <tr>
      <td><strong>backend/others/decoder.py</strong></td> <td>预处理.yo文件</td>
    </tr>
    <tr>
      <td><strong>backend/others/Init.py</strong></td> <td>处理.yo文件</td>
    </tr>
    <tr>
      <td><strong>backend/others/little_endian.py</strong></td> <td>处理数字的小端法表示</td>
    </tr>
    <tr>
      <td><strong>backend/encoder/encoder.py</strong></td> <td>处理.ys文件</td>
    </tr>
  </tbody>
</table>
</td>
</tr>
<tr>
<td>
<table>
  <thead>
        <tr>
            <th>文件名</th><th>文件说明</th>
        </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>backend/memory_sys/memory.py</strong></td> <td>内存的实现</td>
    </tr>
    <tr>
      <td><strong>backend/memory_sys/register.py</strong></td> <td>系统寄存器的实现</td>
    </tr>
    <tr>
      <td><strong>backend/memory_sys/piperegister.py</strong></td> <td>流水线寄存器的实现</td>
    </tr>
  </tbody>
</table>
</td>
<td>
</td>
</tr>
</table>
</div>
</div>

<hr style=" height:2px;border:none;border-top:2px dotted #185598;" >

<h2> 2 使用方法 </h2>
<div>
	<a href="./Usage.html" target="_blank">Y86 Assembly IDE 使用说明</a>
</div>

<hr style=" height:2px;border:none;border-top:2px dotted #185598;" >

<h2> 3 设计 </h2>
<div>
<h3> 3.1 动机 </h3>
<div>
	<p>本次Project要求实现一个Y86 Simulator，要求有较清晰的显示方式。</p>
	<p>
	这是我们第一次写图形界面，几个可行的选择是各种语言自带的图形库、Web、Unity、uwp等等。我们最终选择Python+Web的组合，原因主要有以下几个：
	</p>
	<ol>
		<li>Web自带图形界面，简洁精美</li>
		<li>Web具有强大的前后端交互功能，后端可选择的语言较多</li>
		<li>整个Project的核心是设计一个IDE，后端的代码量会比较大，所以后端选择了较容易上手的Python</li>
		<li>Web和Python的学习资料较多，且未来的用处可能会更多，所以借此机会学习一下Web和Python</li>
	</ol>
	<p>本次Project使用的所有技术均是<strong>现学</strong>的！其中包括：</p>
	<ul>
		<li>Python</li>
		<li>HTML5/CSS3/JavaScript</li>
		<li>Flask/Django</li>
		<li>jQuery/Bootstrap</li>
		<li>JSON/ajax</li>
		<li>Github</li>
	</ul>
	<p>虽然最后没有用到这么多的工具，但借此机会我们了解了前端开发的流程和技术。</p>
</div>
<h3> 3.2 特点 </h3>
<div>
<ul>
  <li>实现Y86指令集的所有指令</li>
  <li>实现流水线的控制逻辑</li>
  <li>添加了<strong>iaddq</strong>操作</li>
  <li>加入了<strong>加载转发</strong>优化(见4.57)</li>
  <li>实现了<strong>Y86汇编器</strong></li>
  <li>支持<strong>动态输入汇编代码</strong></li>
  <li>支持显示<strong>栈、内存、寄存器</strong>中的值</li>
  <li>支持<strong>监控特定值</strong>的功能</li>
  <li>支持<strong>设置断点、步进</strong>等功能</li>
  <li>共支持<strong>22种</strong>动态调试功能</li>
</ul>
</div>
</div>
<hr style=" height:2px;border:none;border-top:2px dotted #185598;" >

<h2> 4 实现细节 </h2>
<div>
	本节将对模拟器的各个部件的具体实现细节进行详述，对于没有提及的细节请查看代码中的注释。
<h3> 4.1 流水线 </h3>
<div>
	<p>实现流程：</p>
	<ol>
		<li>将Register、PipeRegister、Memory、条件码和状态码封装成类，设置好接口以便调试。</li>
		<li>按照Sequence分别实现五个阶段，为了更容易改成流水线版本，每个阶段以上个时间的流水线寄存器为输入，以下个时间的流水线寄存器为输出。</li>
		<li>在Decode阶段中加入转发逻辑</li>
		<li>在kernel.py中加入控制逻辑</li>
	</ol>
</div>
<h3> 4.2 内存 </h3>
<div>
</div>
<h3> 4.3 缓存 </h3>
<div>
</div>
<h3> 4.4 汇编器 </h3>
<div>
</div>
<h3> 4.5 Web界面 </h3>
<div>
</div>
<h3> 4.6 Debug功能 </h3>
<div>
</div>
</div>

<hr style=" height:2px;border:none;border-top:2px dotted #185598;" >
<h2> 5 Evaluation</h2>
<div>
<h3> 5.1 Test Cases </h3>
<div>
test目录下存放了sim中自带的样例，并在/test/new目录下构造了一些新的样例
<table>
  <thead>
    <tr>
      <td><strong>测试文件</strong></td><td><strong>描述</strong></td>
    </tr>
  </thead>
  <tr>
    <td>ex32.yo</td><td>测试转发逻辑(见4.32)</td>
  </tr>
  <tr>
    <td>ex33.yo</td><td>测试转发逻辑(见4.33)</td>
  </tr>
  <tr>
    <td>load_forward.yo</td><td>测试加载转发优化(见4.37)</td>
  </tr>
  <tr>
    <td>overflow.yo</td><td>测试数据溢出</td>
  </tr>
  <tr>
    <td>INS1~4.yo</td><td>测试非法指令</td>
  </tr>
</table>
</div>

<h3> 5.2 Performance </h3>
<div>
</div>
</div>

<hr style=" height:2px;border:none;border-top:2px dotted #185598;" >
<h2> 6 开发过程 </h2>
<div>
<h3> 6.1 开发流程</h3>
<div>
</div>
<h3> 6.2 踩过的坑</h3>
<div>
<ul>
	<li>Python中的long类型没有上界，不会发生溢出，需要进行人工溢出</li>
	<li>五个stages需要倒序执行，因为前面的stage依赖于后面的stage中计算出的值</li>
	<li>Python函数传参要注意是否是可更改</li>
</ul>
</div>
<h3> 6.3 感想</h3>
<div>
</div>
</div>

<hr style=" height:2px;border:none;border-top:2px dotted #185598;" >
<h2> 7 致谢 </h2>
<div>
<ul>
	<li>感谢金城老师为我们解答流水线实现相关的问题</li>
	<li>感谢几位助教给出了宝贵的建议</li>
	<li>感谢胡志峰学长提供PJ以参考</li>
	<li>感谢解润芃、王辰浩等几位同学提供了构造测试样例的思路</li>
</ul>
</div>

</body>
</html>  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
